<!-- Manager Navbar -->
<app-manager-navbar></app-manager-navbar>

<!-- View Requirements Container -->
<div class="container mt-5">
    <h2 class="text-center">Manage Requirements</h2>

    <!-- Search Bar -->
    <div class="mb-3 w-50">
        <input type="text" class="form-control" placeholder="Search requirements..." [(ngModel)]="searchTerm"
            (input)="filterRequirements()"> 
    </div>

    <!-- Requirements Table -->
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Requirement Title</th>
                <th>Description</th>
                <th>Department</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody *ngIf="paginatedRequirements.length; else noRecords">
            <tr *ngFor="let req of paginatedRequirements; let i = index">
                <td>{{ (currentPage -1) * pageSize + i+1 }}</td>
                <td>{{ req.title }}</td>
                <td>{{ req.description }}</td>
                <td>{{ req.department }}</td>
                <td>
                    {{ req.status }}
                </td>
                <td>
                    <button class="btn btn-warning btn-sm me-2"
                        [routerLink]="['/manager/add-requirement', req._id]">Edit</button>
                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal"
                        (click)="setSelectedRequirement(req._id)">Delete</button>
                    <button class="btn btn-sm"
                        [ngClass]="{'btn-success': req.status === 'Closed', 'btn-secondary': req.status === 'Active'}"
                        (click)="toggleStatus(req)">
                        {{ req.status === 'Active' ? 'Mark as Closed' : 'Mark as Active' }}
                    </button>
                </td>
            </tr>
            <tr *ngIf="filteredRequirements.length === 0">
                <td colspan="6" class="text-center text-danger fw-bold">Oops! No records found.</td>
            </tr>
        </tbody>
        <ng-template #noRecords>
            <tr>
                <td colspan="5" class="text-center text-muted">No matching requirements found</td>
            </tr>
        </ng-template>
    </table>
   
</div>

<nav *ngIf="filteredRequirements.length > pageSize" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="previousPage()">Previous</a>
      </li>
  
      <li class="page-item" *ngFor="let page of pages" [class.active]="currentPage === page">
        <a class="page-link" (click)="changePage(page)">{{ page }}</a>
      </li>
  
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="nextPage()">Next</a>
      </li>
    </ul>
  </nav>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-dark">
                Are you sure you want to delete this requirement?
            </div>
            <div class="modal-footer d-flex justify-content-center">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="deleteRequirement()">Yes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>